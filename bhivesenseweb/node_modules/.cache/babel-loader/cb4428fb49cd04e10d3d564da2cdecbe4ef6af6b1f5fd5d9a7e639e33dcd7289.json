{"ast":null,"code":"/*\r\nMEIW - Programação Web Avançada - projeto final\r\nAuhtor: Duarte Cota\r\nDescription: component that implements all the actions concerning login and logout\r\n*/\n\nexport const IS_USER_AUTHENTICATED_GETTER = '[getters] is user autenticated';\nimport { LOGIN_ACTION, AUTH_ACTION, LOGOUT_ACTION, SET_USER_TOKEN_DATA_MUTATION, AUTO_LOGIN_ACTION, AUTO_LOGOUT_ACTION, SET_AUTO_LOGOUT_MUTATION, SET_IMAGE_MUTATION, AUTO_IMAGE_ACTION, IMAGE_ACTION } from '../../storeconstants';\nimport axios from 'axios';\nlet timer = '';\nexport default {\n  [LOGOUT_ACTION](context) {\n    context.commit(SET_USER_TOKEN_DATA_MUTATION, {\n      _id: null,\n      firstname: null,\n      lastname: null,\n      level: null,\n      token: null,\n      img: null,\n      expiresIn: null\n    });\n    localStorage.removeItem('userData');\n    if (timer) {\n      clearTimeout(timer);\n    }\n  },\n  [AUTO_LOGIN_ACTION](context) {\n    let userDataString = localStorage.getItem('userData');\n    console.log(userDataString);\n    if (userDataString) {\n      let userData = JSON.parse(userDataString);\n      let expirationTime = userData.expiresIn - new Date().getTime();\n      if (expirationTime < 10000) {\n        context.dispatch(AUTO_LOGOUT_ACTION);\n      } else {\n        timer = setTimeout(() => {\n          context.dispatch(AUTO_LOGOUT_ACTION);\n        }, expirationTime);\n      }\n      context.commit(SET_USER_TOKEN_DATA_MUTATION, userData);\n    }\n  },\n  [AUTO_LOGOUT_ACTION](context) {\n    context.dispatch(LOGOUT_ACTION);\n    context.commit(SET_AUTO_LOGOUT_MUTATION);\n  },\n  async [AUTH_ACTION](context, payload) {\n    let postData = {\n      username: payload.username,\n      password: payload.password,\n      device: payload.device\n    };\n    let response = await axios.post(payload.url, postData);\n    if (response.data.http === 200) {\n      //let expirationTime = +response.data.body.expiresIn * 1000\n      let expirationTime = 5000;\n      timer = setTimeout(() => {\n        context.dispatch(AUTO_LOGOUT_ACTION);\n      }, expirationTime);\n      let tokenData = {\n        _id: response.data.body._id,\n        firstname: response.data.body.firstname,\n        lastname: response.data.body.lastname,\n        level: response.data.body.level,\n        img: response.data.body.img,\n        expiresIn: expirationTime,\n        token: response.headers.authorization\n      };\n      localStorage.setItem('userData', JSON.stringify(tokenData));\n      //localStorage.setItem('_id', response.data.body._id)\n      context.commit(SET_USER_TOKEN_DATA_MUTATION, tokenData);\n      return true;\n    } else return false;\n  },\n  async [LOGIN_ACTION](context, payload) {\n    return context.dispatch(AUTH_ACTION, {\n      ...payload,\n      url: 'https://bhsapi.duartecota.com/auth'\n    });\n  },\n  async [AUTO_IMAGE_ACTION](context, payload) {\n    return context.dispatch(IMAGE_ACTION, {\n      ...payload\n    });\n  },\n  [IMAGE_ACTION](context, payload) {\n    console.log(payload.img);\n    context.commit(SET_IMAGE_MUTATION, payload);\n  }\n};","map":{"version":3,"names":["IS_USER_AUTHENTICATED_GETTER","LOGIN_ACTION","AUTH_ACTION","LOGOUT_ACTION","SET_USER_TOKEN_DATA_MUTATION","AUTO_LOGIN_ACTION","AUTO_LOGOUT_ACTION","SET_AUTO_LOGOUT_MUTATION","SET_IMAGE_MUTATION","AUTO_IMAGE_ACTION","IMAGE_ACTION","axios","timer","context","commit","_id","firstname","lastname","level","token","img","expiresIn","localStorage","removeItem","clearTimeout","userDataString","getItem","console","log","userData","JSON","parse","expirationTime","Date","getTime","dispatch","setTimeout","payload","postData","username","password","device","response","post","url","data","http","tokenData","body","headers","authorization","setItem","stringify"],"sources":["C:/Users/duart/OneDrive - PGA/Ambiente de Trabalho/bhivesenseweb/bhivesenseweb/src/store/modules/auth/actions.js"],"sourcesContent":["/*\r\nMEIW - Programação Web Avançada - projeto final\r\nAuhtor: Duarte Cota\r\nDescription: component that implements all the actions concerning login and logout\r\n*/\r\n\r\nexport const IS_USER_AUTHENTICATED_GETTER = '[getters] is user autenticated'\r\n\r\nimport {\r\n    LOGIN_ACTION,\r\n    AUTH_ACTION,\r\n    LOGOUT_ACTION,\r\n    SET_USER_TOKEN_DATA_MUTATION,\r\n    AUTO_LOGIN_ACTION,\r\n    AUTO_LOGOUT_ACTION,\r\n    SET_AUTO_LOGOUT_MUTATION,\r\n    SET_IMAGE_MUTATION,\r\n    AUTO_IMAGE_ACTION,\r\n    IMAGE_ACTION\r\n} from '../../storeconstants'\r\n\r\nimport axios from 'axios'\r\n\r\nlet timer = '';\r\n\r\nexport default {\r\n    [LOGOUT_ACTION](context) {\r\n        context.commit(SET_USER_TOKEN_DATA_MUTATION, {\r\n            _id: null,\r\n            firstname: null,\r\n            lastname: null,\r\n            level: null,\r\n            token: null,\r\n            img: null,\r\n            expiresIn: null\r\n        })\r\n        localStorage.removeItem('userData')\r\n        if (timer) {\r\n            clearTimeout(timer)\r\n        }\r\n    },\r\n\r\n    [AUTO_LOGIN_ACTION](context) {\r\n        let userDataString = localStorage.getItem('userData')\r\n        console.log(userDataString)\r\n        if (userDataString) {\r\n            let userData = JSON.parse(userDataString)\r\n            let expirationTime = userData.expiresIn - new Date().getTime()\r\n            if (expirationTime < 10000) {\r\n                context.dispatch(AUTO_LOGOUT_ACTION)\r\n            } else {\r\n                timer = setTimeout(() => {\r\n                    context.dispatch(AUTO_LOGOUT_ACTION)\r\n                }, expirationTime)\r\n            }\r\n            context.commit(SET_USER_TOKEN_DATA_MUTATION, userData)\r\n        }\r\n    },\r\n\r\n    [AUTO_LOGOUT_ACTION](context) {\r\n        context.dispatch(LOGOUT_ACTION)\r\n        context.commit(SET_AUTO_LOGOUT_MUTATION)\r\n    },\r\n\r\n    async [AUTH_ACTION](context, payload) {\r\n        let postData = {\r\n            username: payload.username,\r\n            password: payload.password,\r\n            device: payload.device\r\n        }\r\n        let response = await axios.post(payload.url, postData)\r\n        if (response.data.http === 200) {\r\n            //let expirationTime = +response.data.body.expiresIn * 1000\r\n            let expirationTime = 5000\r\n            timer = setTimeout(() => {\r\n                context.dispatch(AUTO_LOGOUT_ACTION)\r\n            }, expirationTime)\r\n            let tokenData = {\r\n                _id: response.data.body._id,\r\n                firstname: response.data.body.firstname,\r\n                lastname: response.data.body.lastname,\r\n                level: response.data.body.level,\r\n                img: response.data.body.img,\r\n                expiresIn: expirationTime,\r\n                token: response.headers.authorization\r\n            }\r\n            localStorage.setItem('userData', JSON.stringify(tokenData))\r\n                //localStorage.setItem('_id', response.data.body._id)\r\n            context.commit(SET_USER_TOKEN_DATA_MUTATION, tokenData)\r\n            return true\r\n        } else return false\r\n    },\r\n\r\n    async [LOGIN_ACTION](context, payload) {\r\n        return context.dispatch(AUTH_ACTION, {\r\n            ...payload,\r\n            url: 'https://bhsapi.duartecota.com/auth'\r\n        })\r\n    },\r\n\r\n    async [AUTO_IMAGE_ACTION](context, payload) {\r\n        return context.dispatch(IMAGE_ACTION, {\r\n            ...payload\r\n        })\r\n    },\r\n\r\n    [IMAGE_ACTION](context, payload) {\r\n        console.log(payload.img)\r\n        context.commit(SET_IMAGE_MUTATION, payload)\r\n    }\r\n}"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAO,MAAMA,4BAA4B,GAAG,gCAAgC;AAE5E,SACIC,YAAY,EACZC,WAAW,EACXC,aAAa,EACbC,4BAA4B,EAC5BC,iBAAiB,EACjBC,kBAAkB,EAClBC,wBAAwB,EACxBC,kBAAkB,EAClBC,iBAAiB,EACjBC,YAAY,QACT,sBAAsB;AAE7B,OAAOC,KAAK,MAAM,OAAO;AAEzB,IAAIC,KAAK,GAAG,EAAE;AAEd,eAAe;EACX,CAACT,aAAa,EAAEU,OAAO,EAAE;IACrBA,OAAO,CAACC,MAAM,CAACV,4BAA4B,EAAE;MACzCW,GAAG,EAAE,IAAI;MACTC,SAAS,EAAE,IAAI;MACfC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAE,IAAI;MACXC,KAAK,EAAE,IAAI;MACXC,GAAG,EAAE,IAAI;MACTC,SAAS,EAAE;IACf,CAAC,CAAC;IACFC,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;IACnC,IAAIX,KAAK,EAAE;MACPY,YAAY,CAACZ,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,CAACP,iBAAiB,EAAEQ,OAAO,EAAE;IACzB,IAAIY,cAAc,GAAGH,YAAY,CAACI,OAAO,CAAC,UAAU,CAAC;IACrDC,OAAO,CAACC,GAAG,CAACH,cAAc,CAAC;IAC3B,IAAIA,cAAc,EAAE;MAChB,IAAII,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACN,cAAc,CAAC;MACzC,IAAIO,cAAc,GAAGH,QAAQ,CAACR,SAAS,GAAG,IAAIY,IAAI,EAAE,CAACC,OAAO,EAAE;MAC9D,IAAIF,cAAc,GAAG,KAAK,EAAE;QACxBnB,OAAO,CAACsB,QAAQ,CAAC7B,kBAAkB,CAAC;MACxC,CAAC,MAAM;QACHM,KAAK,GAAGwB,UAAU,CAAC,MAAM;UACrBvB,OAAO,CAACsB,QAAQ,CAAC7B,kBAAkB,CAAC;QACxC,CAAC,EAAE0B,cAAc,CAAC;MACtB;MACAnB,OAAO,CAACC,MAAM,CAACV,4BAA4B,EAAEyB,QAAQ,CAAC;IAC1D;EACJ,CAAC;EAED,CAACvB,kBAAkB,EAAEO,OAAO,EAAE;IAC1BA,OAAO,CAACsB,QAAQ,CAAChC,aAAa,CAAC;IAC/BU,OAAO,CAACC,MAAM,CAACP,wBAAwB,CAAC;EAC5C,CAAC;EAED,OAAOL,WAAW,EAAEW,OAAO,EAAEwB,OAAO,EAAE;IAClC,IAAIC,QAAQ,GAAG;MACXC,QAAQ,EAAEF,OAAO,CAACE,QAAQ;MAC1BC,QAAQ,EAAEH,OAAO,CAACG,QAAQ;MAC1BC,MAAM,EAAEJ,OAAO,CAACI;IACpB,CAAC;IACD,IAAIC,QAAQ,GAAG,MAAM/B,KAAK,CAACgC,IAAI,CAACN,OAAO,CAACO,GAAG,EAAEN,QAAQ,CAAC;IACtD,IAAII,QAAQ,CAACG,IAAI,CAACC,IAAI,KAAK,GAAG,EAAE;MAC5B;MACA,IAAId,cAAc,GAAG,IAAI;MACzBpB,KAAK,GAAGwB,UAAU,CAAC,MAAM;QACrBvB,OAAO,CAACsB,QAAQ,CAAC7B,kBAAkB,CAAC;MACxC,CAAC,EAAE0B,cAAc,CAAC;MAClB,IAAIe,SAAS,GAAG;QACZhC,GAAG,EAAE2B,QAAQ,CAACG,IAAI,CAACG,IAAI,CAACjC,GAAG;QAC3BC,SAAS,EAAE0B,QAAQ,CAACG,IAAI,CAACG,IAAI,CAAChC,SAAS;QACvCC,QAAQ,EAAEyB,QAAQ,CAACG,IAAI,CAACG,IAAI,CAAC/B,QAAQ;QACrCC,KAAK,EAAEwB,QAAQ,CAACG,IAAI,CAACG,IAAI,CAAC9B,KAAK;QAC/BE,GAAG,EAAEsB,QAAQ,CAACG,IAAI,CAACG,IAAI,CAAC5B,GAAG;QAC3BC,SAAS,EAAEW,cAAc;QACzBb,KAAK,EAAEuB,QAAQ,CAACO,OAAO,CAACC;MAC5B,CAAC;MACD5B,YAAY,CAAC6B,OAAO,CAAC,UAAU,EAAErB,IAAI,CAACsB,SAAS,CAACL,SAAS,CAAC,CAAC;MACvD;MACJlC,OAAO,CAACC,MAAM,CAACV,4BAA4B,EAAE2C,SAAS,CAAC;MACvD,OAAO,IAAI;IACf,CAAC,MAAM,OAAO,KAAK;EACvB,CAAC;EAED,OAAO9C,YAAY,EAAEY,OAAO,EAAEwB,OAAO,EAAE;IACnC,OAAOxB,OAAO,CAACsB,QAAQ,CAACjC,WAAW,EAAE;MACjC,GAAGmC,OAAO;MACVO,GAAG,EAAE;IACT,CAAC,CAAC;EACN,CAAC;EAED,OAAOnC,iBAAiB,EAAEI,OAAO,EAAEwB,OAAO,EAAE;IACxC,OAAOxB,OAAO,CAACsB,QAAQ,CAACzB,YAAY,EAAE;MAClC,GAAG2B;IACP,CAAC,CAAC;EACN,CAAC;EAED,CAAC3B,YAAY,EAAEG,OAAO,EAAEwB,OAAO,EAAE;IAC7BV,OAAO,CAACC,GAAG,CAACS,OAAO,CAACjB,GAAG,CAAC;IACxBP,OAAO,CAACC,MAAM,CAACN,kBAAkB,EAAE6B,OAAO,CAAC;EAC/C;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}