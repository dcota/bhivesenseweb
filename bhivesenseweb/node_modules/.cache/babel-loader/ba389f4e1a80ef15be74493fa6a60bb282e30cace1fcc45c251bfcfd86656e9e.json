{"ast":null,"code":"/*\r\nMEIW - Programação Web Avançada - projeto final\r\nAuhtor: Duarte Cota\r\nDescription: component that implements all the actions concerning login and logout\r\n*/\n\nexport const IS_USER_AUTHENTICATED_GETTER = '[getters] is user autenticated';\nimport { LOGIN_ACTION, AUTH_ACTION, LOGOUT_ACTION, SET_USER_TOKEN_DATA_MUTATION, AUTO_LOGIN_ACTION, AUTO_LOGOUT_ACTION, SET_AUTO_LOGOUT_MUTATION, SET_IMAGE_MUTATION, AUTO_IMAGE_ACTION, IMAGE_ACTION, APIDTOEDIT_ACTION, SET_APIDTOEDIT_MUTATION, AUTO_APIDTOEDIT_ACTION, AUTO_NUMEVENTS_ACTION, NUMEVENTS_ACTION, SET_NUMEVENTS_MUTATION } from '../../storeconstants';\nimport axios from 'axios';\nlet timer = '';\nexport default {\n  [LOGOUT_ACTION](context) {\n    context.commit(SET_USER_TOKEN_DATA_MUTATION, {\n      _id: null,\n      firstname: null,\n      lastname: null,\n      level: null,\n      token: null,\n      img: null,\n      expiresIn: null\n    });\n    localStorage.removeItem('userData');\n    if (timer) {\n      clearTimeout(timer);\n    }\n  },\n  [AUTO_LOGIN_ACTION](context) {\n    let userDataString = localStorage.getItem('userData');\n    if (userDataString) {\n      let userData = JSON.parse(userDataString);\n      let expirationTime = userData.expiresIn - new Date().getTime();\n      if (expirationTime < 10000) {\n        context.dispatch(AUTO_LOGOUT_ACTION);\n      } else {\n        timer = setTimeout(() => {\n          context.dispatch(AUTO_LOGOUT_ACTION);\n        }, expirationTime);\n      }\n      context.commit(SET_USER_TOKEN_DATA_MUTATION, userData);\n    }\n  },\n  [AUTO_LOGOUT_ACTION](context) {\n    context.dispatch(LOGOUT_ACTION);\n    context.commit(SET_AUTO_LOGOUT_MUTATION);\n  },\n  async [AUTH_ACTION](context, payload) {\n    let postData = {\n      username: payload.username,\n      password: payload.password,\n      device: payload.device\n    };\n    let response = await axios.post(payload.url, postData);\n    if (response.data.http === 200) {\n      let expirationTime = +response.data.body.expiresIn * 1000;\n      //let expirationTime = 600000\n      timer = setTimeout(() => {\n        context.dispatch(AUTO_LOGOUT_ACTION);\n      }, expirationTime);\n      let img;\n      response.data.body.img == '' ? img = 'https://bhsapi.duartecota.com/img/avatar.png' : img = response.data.body.img;\n      let tokenData = {\n        _id: response.data.body._id,\n        firstname: response.data.body.firstname,\n        lastname: response.data.body.lastname,\n        level: response.data.body.level,\n        img: img,\n        expiresIn: expirationTime,\n        token: response.headers.authorization,\n        numEvents: 0\n      };\n      localStorage.setItem('userData', JSON.stringify(tokenData));\n      context.commit(SET_USER_TOKEN_DATA_MUTATION, tokenData);\n      return true;\n    } else return false;\n  },\n  async [LOGIN_ACTION](context, payload) {\n    return context.dispatch(AUTH_ACTION, {\n      ...payload,\n      url: 'https://bhsapi.duartecota.com/auth'\n    });\n  },\n  async [AUTO_IMAGE_ACTION](context, payload) {\n    return context.dispatch(IMAGE_ACTION, {\n      ...payload\n    });\n  },\n  [IMAGE_ACTION](context, payload) {\n    context.commit(SET_IMAGE_MUTATION, payload);\n  },\n  async [AUTO_NUMEVENTS_ACTION](context, payload) {\n    console.payload;\n    return context.dispatch(NUMEVENTS_ACTION, {\n      ...payload\n    });\n  },\n  [NUMEVENTS_ACTION](context, payload) {\n    context.commit(SET_NUMEVENTS_MUTATION, payload);\n  }\n};","map":{"version":3,"names":["IS_USER_AUTHENTICATED_GETTER","LOGIN_ACTION","AUTH_ACTION","LOGOUT_ACTION","SET_USER_TOKEN_DATA_MUTATION","AUTO_LOGIN_ACTION","AUTO_LOGOUT_ACTION","SET_AUTO_LOGOUT_MUTATION","SET_IMAGE_MUTATION","AUTO_IMAGE_ACTION","IMAGE_ACTION","APIDTOEDIT_ACTION","SET_APIDTOEDIT_MUTATION","AUTO_APIDTOEDIT_ACTION","AUTO_NUMEVENTS_ACTION","NUMEVENTS_ACTION","SET_NUMEVENTS_MUTATION","axios","timer","context","commit","_id","firstname","lastname","level","token","img","expiresIn","localStorage","removeItem","clearTimeout","userDataString","getItem","userData","JSON","parse","expirationTime","Date","getTime","dispatch","setTimeout","payload","postData","username","password","device","response","post","url","data","http","body","tokenData","headers","authorization","numEvents","setItem","stringify","console"],"sources":["C:/Users/duart/OneDrive - PGA/Ambiente de Trabalho/bhivesenseweb/bhivesenseweb/src/store/modules/auth/actions.js"],"sourcesContent":["/*\r\nMEIW - Programação Web Avançada - projeto final\r\nAuhtor: Duarte Cota\r\nDescription: component that implements all the actions concerning login and logout\r\n*/\r\n\r\nexport const IS_USER_AUTHENTICATED_GETTER = '[getters] is user autenticated'\r\n\r\nimport {\r\n    LOGIN_ACTION,\r\n    AUTH_ACTION,\r\n    LOGOUT_ACTION,\r\n    SET_USER_TOKEN_DATA_MUTATION,\r\n    AUTO_LOGIN_ACTION,\r\n    AUTO_LOGOUT_ACTION,\r\n    SET_AUTO_LOGOUT_MUTATION,\r\n    SET_IMAGE_MUTATION,\r\n    AUTO_IMAGE_ACTION,\r\n    IMAGE_ACTION,\r\n    APIDTOEDIT_ACTION,\r\n    SET_APIDTOEDIT_MUTATION,\r\n    AUTO_APIDTOEDIT_ACTION,\r\n    AUTO_NUMEVENTS_ACTION,\r\n    NUMEVENTS_ACTION,\r\n    SET_NUMEVENTS_MUTATION\r\n} from '../../storeconstants'\r\n\r\nimport axios from 'axios'\r\n\r\nlet timer = '';\r\n\r\nexport default {\r\n    [LOGOUT_ACTION](context) {\r\n        context.commit(SET_USER_TOKEN_DATA_MUTATION, {\r\n            _id: null,\r\n            firstname: null,\r\n            lastname: null,\r\n            level: null,\r\n            token: null,\r\n            img: null,\r\n            expiresIn: null,\r\n        })\r\n        localStorage.removeItem('userData')\r\n        if (timer) {\r\n            clearTimeout(timer)\r\n        }\r\n    },\r\n\r\n    [AUTO_LOGIN_ACTION](context) {\r\n        let userDataString = localStorage.getItem('userData')\r\n        if (userDataString) {\r\n            let userData = JSON.parse(userDataString)\r\n            let expirationTime = userData.expiresIn - new Date().getTime()\r\n            if (expirationTime < 10000) {\r\n                context.dispatch(AUTO_LOGOUT_ACTION)\r\n            } else {\r\n                timer = setTimeout(() => {\r\n                    context.dispatch(AUTO_LOGOUT_ACTION)\r\n                }, expirationTime)\r\n            }\r\n            context.commit(SET_USER_TOKEN_DATA_MUTATION, userData)\r\n        }\r\n    },\r\n\r\n    [AUTO_LOGOUT_ACTION](context) {\r\n        context.dispatch(LOGOUT_ACTION)\r\n        context.commit(SET_AUTO_LOGOUT_MUTATION)\r\n    },\r\n\r\n    async [AUTH_ACTION](context, payload) {\r\n        let postData = {\r\n            username: payload.username,\r\n            password: payload.password,\r\n            device: payload.device\r\n        }\r\n        let response = await axios.post(payload.url, postData)\r\n        if (response.data.http === 200) {\r\n            let expirationTime = +response.data.body.expiresIn * 1000\r\n                //let expirationTime = 600000\r\n            timer = setTimeout(() => {\r\n                context.dispatch(AUTO_LOGOUT_ACTION)\r\n            }, expirationTime)\r\n            let img\r\n            response.data.body.img == '' ? img = 'https://bhsapi.duartecota.com/img/avatar.png' : img = response.data.body.img\r\n            let tokenData = {\r\n                _id: response.data.body._id,\r\n                firstname: response.data.body.firstname,\r\n                lastname: response.data.body.lastname,\r\n                level: response.data.body.level,\r\n                img: img,\r\n                expiresIn: expirationTime,\r\n                token: response.headers.authorization,\r\n                numEvents: 0\r\n            }\r\n            localStorage.setItem('userData', JSON.stringify(tokenData))\r\n            context.commit(SET_USER_TOKEN_DATA_MUTATION, tokenData)\r\n            return true\r\n        } else return false\r\n    },\r\n\r\n    async [LOGIN_ACTION](context, payload) {\r\n        return context.dispatch(AUTH_ACTION, {\r\n            ...payload,\r\n            url: 'https://bhsapi.duartecota.com/auth'\r\n\r\n        })\r\n    },\r\n\r\n    async [AUTO_IMAGE_ACTION](context, payload) {\r\n        return context.dispatch(IMAGE_ACTION, {\r\n            ...payload\r\n        })\r\n    },\r\n\r\n    [IMAGE_ACTION](context, payload) {\r\n        context.commit(SET_IMAGE_MUTATION, payload)\r\n    },\r\n\r\n    async [AUTO_NUMEVENTS_ACTION](context, payload) {\r\n        console.payload\r\n        return context.dispatch(NUMEVENTS_ACTION, {\r\n            ...payload\r\n        })\r\n    },\r\n\r\n    [NUMEVENTS_ACTION](context, payload) {\r\n        context.commit(SET_NUMEVENTS_MUTATION, payload)\r\n    }\r\n\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}